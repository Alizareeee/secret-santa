<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"app_js_controllers_secret-santa.js.html":{"id":"app_js_controllers_secret-santa.js.html","title":"Source: app/js/controllers/secret-santa.js","body":" DocStrap Global addSantadeleteRenewgetMatchinitmakeMatchsantasecretSantaCtrl Source: app/js/controllers/secret-santa.js /* * @Author: Ali * @Date: 2017-02-23 22:56:03 * @Last Modified by: Ali * @Last Modified time: 2017-02-28 09:39:39 */ (function(){ /** * secretSantaCtrl Controller that get info from santa factory. * * @function secretSantaCtrl * @param {Object} $scope provided by AngularJs * @param {Object} santa injected factory written by me. */ 'use strict'; angular.module('secretSantaApp').controller('secretSantaCtrl', ['$scope', 'santa', function($scope, santa){ /** * It used for initialization of app at the begining and after each change. * * @function init */ function init(){ $scope.santas = 0; $scope.lastSanta = &quot;N/A&quot;; $scope.match = &quot;N/A&quot;; $scope.passAlert = false; $scope.admin = {}; $scope.santa = {}; $scope.getter = {}; $scope.terminate = false; santa.lastSanta().then(function(response){ var lastSanta = &quot;N/A&quot;; if (response.data.length !== 0 ) { var last = response.data[0].name; lastSanta = last.charAt(0).toUpperCase() + last.substr(1).toLowerCase(); } $scope.lastSanta = &quot;&quot; || lastSanta; }); santa.count().then(function(response){ $scope.santas = response.data; }); } init(); /** * Adds new Santa, and send it server and mongoDB. It is connected to the SIGNUP BUTTOM * * @function addSanta */ $scope.addSanta = function(){ /** Name for Santa which is assumed to be unique * @default &quot;&quot; * @type {string} */ $scope.santa.name = $scope.santa.name || ''; /** @default &quot;&quot; */ $scope.santa.spouse = $scope.santa.spouse || ''; if ($scope.santa.name.length !==0){ // console.log(&quot;addSanta: Good to talk to server&quot;); santa.post($scope.santa).then(function(response){ // console.log('New Santa is added'); }); } init(); }; /** * If admin enter right email/password the he/she can terminate this round of giftitng. It is connected to the TERMINATE &amp;MAKE MATCHES * email is admin@smith.com * password is 123 * @function makeMatch */ $scope.makeMatch = function(){ /** @default &quot;&quot; */ $scope.admin.email = $scope.admin.email || ''; /** @default &quot;&quot; */ $scope.admin.pass = $scope.admin.pass || ''; santa.matchMaker($scope.admin).then(function(response){ $scope.passAlert = false; $scope.terminate = true; },function(error){ console.log('Error from server: %s', error.data); $scope.passAlert = true; }); }; /** * If admin enter right email/password the he/she can DELETE this round of giftitng. It is connected to the DELETE &amp; RENEW button * email is admin@smith.com * password is 123 * * @function deleteRenew */ $scope.deleteRenew = function(){ /** @default &quot;&quot; */ $scope.admin.email = $scope.admin.email || ''; /** @default &quot;&quot; */ $scope.admin.pass = $scope.admin.pass || ''; santa.removeFamily($scope.admin).then(function(response){ $scope.terminate = false; $scope.passAlert = false; init(); }, function(error){ console.log('Error from server: %s', error.data); $scope.passAlert = true; }); }; /** * Shows the Santa his/her match to buy gift * * @function getMatch */ $scope.getMatch = function(){ /** @default &quot;&quot; */ $scope.gifter.name = $scope.gifter.name || ''; if ($scope.gifter.name.length !==0){ santa.getMatch($scope.gifter).then(function(response){ if (response.data) { if (response.data.match.length !==0){ $scope.match = response.data.match; $scope.matchalert = false; }else{ $scope.match = &quot;N/A&quot;; $scope.matchalert = false; } }else{ $scope.matchalert = true; } }); } }; }]); }()); × Search results Close "},"routes_route.js.html":{"id":"routes_route.js.html","title":"Source: routes/route.js","body":" DocStrap Global addSantadeleteRenewgetMatchinitmakeMatchsantasecretSantaCtrl Source: routes/route.js /* * @Author: Ali * @Date: 2017-02-25 13:31:00 * @Last Modified by: Ali * @Last Modified time: 2017-02-26 23:35:13 */ module.exports = function(app, express, bodyParser, MongoClient, config){ 'use strict' // connecting to MoogoLab servive. var db; MongoClient.connect( config.mongoLaClient, (err, database) =&gt; { if (err) return console.log(err); db = database; app.listen(app.get('port'), () =&gt; { console.log('Server is listening on port ' + app.get('port') + '. Press CTRL-C to terminate.'); }); }); /** * Gives the name of last registered Santa to be shown in the dashboard * @memberof app */ app.get('/lastsanta', (req, res) =&gt; { var cursor = db.collection('santas').find().limit(1).sort({$natural:-1}).toArray((err, results) =&gt; { if (err) return console.log(err); res.json(results); }); }); /** * Counts number of register Santa to be shown in dashboard * @memberof app */ app.get('/countsanta', (req, res) =&gt; { var cursor = db.collection('santas').find().toArray((err, results) =&gt; { if (err) return console.log(err); res.json(results.length); }); }); /** * Register Sanata, if they have spouse, they are supposed to enter it. At the moment, I couldnt cover removing duplicated santa, and making object for spouse in the same time. * @memberof app */ app.post('/register', (req, res) =&gt; { if (req.body.name.length !== 0){ // ideally check if the database is already created anf has something in it // ideally check for duplicated santa var newSanta = {}; newSanta.name = req.body.name.toLowerCase(); newSanta.spouse = req.body.spouse.toLowerCase(); newSanta.match = ''; db.collection('santas').save(newSanta, (err, result) =&gt; { if (err) return console.log(err); }); // I added this to handle duplicated case but it didnot work db.collection('santas').ensureIndex({'name': newSanta.name}, {unique: true, dropDups: true}); res.redirect('/'); } else { res.redirect('/'); } }); /** * Gives each Santa his/her match ro buys gift * @memberof app */ app.post('/myMatch', (req, res) =&gt; { if (req.body.name.length !== 0 ){ db.collection('santas').find({ name: req.body.name }).toArray((err, results) =&gt; { if (results.length !==0) { // Correct name res.json(results[0]); } else { // Wrong name res.json(results); } }); } else { res.redirect('/'); } }); /** * Prodives match for each Santa if correct username and password is provided by admin. Shuffling technic is used. * @memberof app */ app.post('/makeMatch', (req, res) =&gt; { if (req.body.email.length !== 0 &amp;&amp; req.body.pass.length !== 0){ if (req.body.email === 'admin@smith.com' &amp;&amp; req.body.pass === '123'){ // I am using shuffiling method. var santas = []; var matches = []; var ok = false; db.collection('santas').find().toArray((err, results) =&gt; { if (err) return console.log(err); santas = results; db.collection('santas').find().toArray((error, outputs) =&gt; { if (error) return console.log(error); matches = outputs; //shuffle until a good match var santaLength = santas.length; while(!ok) { shuffle(matches); var i = santaLength -1; while( i &gt;= 0 ){ if(santas[i].name === matches[i].name || santas[i].spouse === matches[i].name ){ ok = false; break; }else{ ok = true; } i -= 1; } } // Once we are in a good shuffle, assign matches and save them if(ok) { var j = santaLength -1; while( j &gt;= 0 ){ db.collection('santas').findOneAndUpdate( {name: santas[j].name}, {$set: {match: matches[j].name}}, {new: true}, (err, doc) =&gt; { if(err){ console.log(&quot;Something wrong when updating data!&quot;);} j -= 1; } ); santas[j].match = matches[j].name; j -= 1; } } }); }); res.send('We should have a match, now!'); } else { res.status(400).send('Wrong username and password for the admin'); } } }); /** * Deletes full Santa collection if correct username and password is provided by admin * @memberof app */ app.post('/deletefamily', (req, res) =&gt; { if (req.body.email.length !== 0 &amp;&amp; req.body.pass.length !== 0){ if (req.body.email === 'admin@smith.com' &amp;&amp; req.body.pass === '123'){ db.collection('santas').drop((err, doc) =&gt; { res.send(doc); }); } else { res.status(400).send('Wrong username and password for the admin'); } } }); /** * Shuffles array in place. Fisher-Yates Shuffle * @param {Array} a items The array containing the items. * @source http://jsfromhell.com/array/shuffle */ function shuffle(array) { let counter = array.length; // While there are elements in the array while (counter &gt; 0) { // Pick a random index let index = Math.floor(Math.random() * counter); // Decrease counter by 1 counter--; // And swap the last element with it let temp = array[counter]; array[counter] = array[index]; array[index] = temp; } return array; } } × Search results Close "},"app_js_services_santafactory.js.html":{"id":"app_js_services_santafactory.js.html","title":"Source: app/js/services/santafactory.js","body":" DocStrap Global addSantadeleteRenewgetMatchinitmakeMatchsantasecretSantaCtrl Source: app/js/services/santafactory.js /* * @Author: Ali * @Date: 2017-02-24 03:59:26 * @Last Modified by: Ali * @Last Modified time: 2017-02-28 09:33:38 */ (function(){ 'use strict'; /** * santa Factory that get info from santa factory. * * @function santa * @param {Object} $scope provided by AngularJS * @return {Object} santa */ angular.module('secretSantaApp').factory('santa', ['$http', function($http){ var santa = {}; santa.post = function(newSanta){ return $http.post('/register', newSanta); }; santa.getMatch = function(me){ return $http.post('/myMatch', me); }; santa.lastSanta = function(){ return $http.get('/lastsanta'); }; santa.count = function(){ return $http.get('/countsanta'); }; santa.matchMaker = function(admin){ return $http.post('/makeMatch', admin); }; santa.removeFamily = function(admin){ return $http.post('/deletefamily', admin); }; return santa; }]); }()); × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" DocStrap Global addSantadeleteRenewgetMatchinitmakeMatchsantasecretSantaCtrl Global Methods addSanta() Adds new Santa, and send it server and mongoDB. It is connected to the SIGNUP BUTTOM Source: app/js/controllers/secret-santa.js, line 47 deleteRenew() If admin enter right email/password the he/she can DELETE this round of giftitng. It is connected to the DELETE &amp; RENEW button email is admin@smith.com password is 123 Source: app/js/controllers/secret-santa.js, line 89 getMatch() Shows the Santa his/her match to buy gift Source: app/js/controllers/secret-santa.js, line 111 init() It used for initialization of app at the begining and after each change. Source: app/js/controllers/secret-santa.js, line 19 makeMatch() If admin enter right email/password the he/she can terminate this round of giftitng. It is connected to the TERMINATE &amp;MAKE MATCHES email is admin@smith.com password is 123 Source: app/js/controllers/secret-santa.js, line 69 santa($scope) santa Factory that get info from santa factory. Parameters: Name Type Description $scope Object provided by AngularJS Source: app/js/services/santafactory.js, line 9 Returns: santa Type Object secretSantaCtrl($scope, santa) secretSantaCtrl Controller that get info from santa factory. Parameters: Name Type Description $scope Object provided by AngularJs santa Object injected factory written by me. Source: app/js/controllers/secret-santa.js, line 9 × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" DocStrap Global addSantadeleteRenewgetMatchinitmakeMatchsantasecretSantaCtrl × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
